<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.mockvoting.domain.community.mapper.PostCommentMapper">
    <select id="selectTopLevelCommentsByPostId" resultType="com.example.mockvoting.domain.community.dto.PostCommentResponseDTO">
        SELECT
            post_comment.id,
            post_comment.post_id,
            post_comment.parent_id,
            post_comment.author_id,
            post_comment.content,
            post_comment.depth,
            (post_comment.upvotes - post_comment.downvotes) AS vote_count,
            post_comment.created_at,
            post_comment.updated_at,
            user.nickname AS author_nickname
        FROM post_comment
                 JOIN user ON post_comment.author_id = user.user_id
        WHERE post_comment.post_id = #{postId}
          AND post_comment.depth = 0
          AND post_comment.is_deleted = FALSE
        ORDER BY post_comment.created_at ASC
            LIMIT #{limit} OFFSET #{offset}
    </select>
</mapper>